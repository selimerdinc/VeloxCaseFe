{"ast":null,"code":"var _s = $RefreshSig$();\n// src/features/auth/useAuth.js\n\nimport { useState, useEffect, useCallback } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\nconst API_BASE_URL = 'https://quickcase-api.onrender.com/api';\n\n/**\n * useAuth: Kimlik doÄŸrulama (GiriÅŸ/KayÄ±t) mantÄ±ÄŸÄ±nÄ± yÃ¶neten Ã¶zel Hook.\n */\nexport const useAuth = () => {\n  _s();\n  // --- KRÄ°TÄ°K DÃœZELTME: BaÅŸlangÄ±Ã§ta token'Ä± NULL yapÄ±yoruz. ---\n  const [token, setToken] = useState(null);\n  const [isLoadingInitial, setIsLoadingInitial] = useState(true); // Token yÃ¼kleniyor mu?\n\n  const [isRegistering, setIsRegistering] = useState(false);\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [showPassword, setShowPassword] = useState(false);\n  const [authLoading, setAuthLoading] = useState(false);\n  const [errors, setErrors] = useState({\n    username: false,\n    password: false\n  });\n\n  // YENÄ°: Yeniden render'Ä± tetiklemek iÃ§in anahtar (Login Hang Fix)\n  const [authKey, setAuthKey] = useState(0);\n\n  // --- YAN ETKÄ°: LocalStorage'dan Ä°lk YÃ¼kleme ve Axios Header AyarÄ± ---\n  useEffect(() => {\n    const storedToken = localStorage.getItem('qc_token');\n    if (storedToken) {\n      setToken(storedToken);\n      axios.defaults.headers.common['Authorization'] = `Bearer ${storedToken}`;\n    }\n    setIsLoadingInitial(false);\n    // Bu useEffect sadece bir kez Ã§alÄ±ÅŸÄ±r ([])\n  }, []);\n\n  // Token her deÄŸiÅŸtiÄŸinde Axios Header'Ä±nÄ± GÃœNCELLE\n  useEffect(() => {\n    if (token) {\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    } else {\n      delete axios.defaults.headers.common['Authorization'];\n    }\n  }, [token]);\n\n  // --- YARDIMCI FONKSÄ°YON: Åžifre GÃ¼cÃ¼ ---\n  const getStrength = pass => {\n    if (!pass) return 0;\n    let score = 0;\n    if (pass.length > 7) score += 25;\n    if (/[A-Z]/.test(pass)) score += 25;\n    if (/[0-9]/.test(pass)) score += 25;\n    if (/[^A-Za-z0-9]/.test(pass)) score += 25;\n    return score;\n  };\n  const strengthScore = getStrength(password);\n\n  // --- Ä°ÅžLEV: Oturum AÃ§ma / KayÄ±t Olma ---\n  const handleAuth = useCallback(async e => {\n    e.preventDefault();\n\n    // 1. Validasyon KontrolÃ¼ (AynÄ± kalÄ±r)\n    const newErrors = {\n      username: !username.trim(),\n      password: !password.trim()\n    };\n    setErrors(newErrors);\n    if (newErrors.username || newErrors.password) {\n      /* ... */return;\n    }\n    if (isRegistering && password.length < 8) {\n      /* ... */return;\n    }\n    setAuthLoading(true);\n    const endpoint = isRegistering ? '/register' : '/login';\n    try {\n      const res = await axios.post(`${API_BASE_URL}${endpoint}`, {\n        username,\n        password\n      });\n      const receivedToken = res.data.access_token;\n      if (!receivedToken) {\n        throw new Error(\"API'den geÃ§erli token alÄ±namadÄ±.\");\n      }\n      if (isRegistering) {\n        toast.success(`Tebrikler! HesabÄ±nÄ±z oluÅŸturuldu. GiriÅŸ sayfasÄ±na yÃ¶nlendiriliyorsunuz.`, {\n          icon: 'âœ…',\n          duration: 5000\n        });\n        setIsRegistering(false);\n        setPassword('');\n      } else {\n        // GiriÅŸ baÅŸarÄ±lÄ±:\n        localStorage.setItem('qc_token', receivedToken);\n\n        // KRÄ°TÄ°K: setToken'Ä± Ã§aÄŸÄ±r ve anahtarÄ± deÄŸiÅŸtirerek App.jsx'i zorla.\n        setToken(receivedToken);\n        setAuthKey(prev => prev + 1);\n\n        // Form alanlarÄ±nÄ± temizle\n        setUsername('');\n        setPassword('');\n        setErrors({\n          username: false,\n          password: false\n        });\n        toast.success(`GiriÅŸ BaÅŸarÄ±lÄ±! Sisteme hoÅŸ geldiniz, ${username}.`, {\n          icon: 'ðŸ‘‹'\n        });\n      }\n    } catch (err) {/* ... hata yÃ¶netimi aynÄ± kalÄ±r ... */} finally {\n      setAuthLoading(false);\n    }\n  }, [username, password, isRegistering]);\n\n  // --- Ä°ÅžLEV: Oturumu Kapatma ---\n  const handleLogout = useCallback(() => {\n    localStorage.removeItem('qc_token');\n    setToken(null);\n    setAuthKey(prev => prev + 1); // Logout'ta da yenile\n    setUsername('');\n    setPassword('');\n    setErrors({\n      username: false,\n      password: false\n    });\n    toast('Oturum gÃ¼venli bir ÅŸekilde sonlandÄ±rÄ±ldÄ±.', {\n      icon: 'ðŸ”’'\n    });\n  }, []);\n\n  // --- Ä°ÅžLEV: Åžifremi Unuttum ---\n  const handleForgotPassword = useCallback(() => {/* ... aynÄ± kalÄ±r ... */}, []);\n\n  // --- KAPSÃœLLENMÄ°Åž ARAYÃœZ ---\n  return {\n    // State ve DeÄŸerler\n    token: token,\n    // ArtÄ±k sadece token'Ä± dÃ¶ndÃ¼rÃ¼yoruz.\n    authKey,\n    strengthScore,\n    isRegistering,\n    username,\n    password,\n    showPassword,\n    authLoading,\n    errors,\n    // YÃ¼kleniyorsa boÅŸ ekran gÃ¶ster (UX)\n    isInitialized: !isLoadingInitial,\n    // State DeÄŸiÅŸtiriciler (Setters)\n    setUsername: value => {\n      /* ... */setUsername(value);\n      if (errors.username) setErrors(e => ({\n        ...e,\n        username: false\n      }));\n    },\n    setPassword: value => {\n      /* ... */setPassword(value);\n      if (errors.password) setErrors(e => ({\n        ...e,\n        password: false\n      }));\n    },\n    setIsRegistering,\n    setShowPassword,\n    // Ä°ÅŸlevler\n    handleAuth,\n    handleLogout,\n    handleForgotPassword\n  };\n};\n_s(useAuth, \"S5a0/A87X3IlovFNb5BL0Yh9Nlk=\");","map":{"version":3,"names":["useState","useEffect","useCallback","axios","toast","API_BASE_URL","useAuth","_s","token","setToken","isLoadingInitial","setIsLoadingInitial","isRegistering","setIsRegistering","username","setUsername","password","setPassword","showPassword","setShowPassword","authLoading","setAuthLoading","errors","setErrors","authKey","setAuthKey","storedToken","localStorage","getItem","defaults","headers","common","getStrength","pass","score","length","test","strengthScore","handleAuth","e","preventDefault","newErrors","trim","endpoint","res","post","receivedToken","data","access_token","Error","success","icon","duration","setItem","prev","err","handleLogout","removeItem","handleForgotPassword","isInitialized","value"],"sources":["/Users/btcyz554/PycharmProjects/VeloxCaseFe/src/features/auth/useAuth.js"],"sourcesContent":["// src/features/auth/useAuth.js\n\nimport { useState, useEffect, useCallback } from 'react';\nimport axios from 'axios';\nimport toast from 'react-hot-toast';\n\nconst API_BASE_URL = 'https://quickcase-api.onrender.com/api';\n\n/**\n * useAuth: Kimlik doÄŸrulama (GiriÅŸ/KayÄ±t) mantÄ±ÄŸÄ±nÄ± yÃ¶neten Ã¶zel Hook.\n */\nexport const useAuth = () => {\n    // --- KRÄ°TÄ°K DÃœZELTME: BaÅŸlangÄ±Ã§ta token'Ä± NULL yapÄ±yoruz. ---\n    const [token, setToken] = useState(null);\n    const [isLoadingInitial, setIsLoadingInitial] = useState(true); // Token yÃ¼kleniyor mu?\n\n    const [isRegistering, setIsRegistering] = useState(false);\n    const [username, setUsername] = useState('');\n    const [password, setPassword] = useState('');\n    const [showPassword, setShowPassword] = useState(false);\n    const [authLoading, setAuthLoading] = useState(false);\n    const [errors, setErrors] = useState({ username: false, password: false });\n\n    // YENÄ°: Yeniden render'Ä± tetiklemek iÃ§in anahtar (Login Hang Fix)\n    const [authKey, setAuthKey] = useState(0);\n\n    // --- YAN ETKÄ°: LocalStorage'dan Ä°lk YÃ¼kleme ve Axios Header AyarÄ± ---\n    useEffect(() => {\n        const storedToken = localStorage.getItem('qc_token');\n        if (storedToken) {\n            setToken(storedToken);\n            axios.defaults.headers.common['Authorization'] = `Bearer ${storedToken}`;\n        }\n        setIsLoadingInitial(false);\n        // Bu useEffect sadece bir kez Ã§alÄ±ÅŸÄ±r ([])\n    }, []);\n\n    // Token her deÄŸiÅŸtiÄŸinde Axios Header'Ä±nÄ± GÃœNCELLE\n    useEffect(() => {\n        if (token) {\n            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n        } else {\n            delete axios.defaults.headers.common['Authorization'];\n        }\n    }, [token]);\n\n\n    // --- YARDIMCI FONKSÄ°YON: Åžifre GÃ¼cÃ¼ ---\n    const getStrength = (pass) => {\n        if(!pass) return 0;\n        let score = 0;\n        if (pass.length > 7) score += 25;\n        if (/[A-Z]/.test(pass)) score += 25;\n        if (/[0-9]/.test(pass)) score += 25;\n        if (/[^A-Za-z0-9]/.test(pass)) score += 25;\n        return score;\n    }\n    const strengthScore = getStrength(password);\n\n    // --- Ä°ÅžLEV: Oturum AÃ§ma / KayÄ±t Olma ---\n    const handleAuth = useCallback(async (e) => {\n        e.preventDefault();\n\n        // 1. Validasyon KontrolÃ¼ (AynÄ± kalÄ±r)\n        const newErrors = {\n            username: !username.trim(),\n            password: !password.trim()\n        };\n        setErrors(newErrors);\n        if (newErrors.username || newErrors.password) { /* ... */ return; }\n        if (isRegistering && password.length < 8) { /* ... */ return; }\n\n        setAuthLoading(true);\n        const endpoint = isRegistering ? '/register' : '/login';\n\n        try {\n            const res = await axios.post(`${API_BASE_URL}${endpoint}`, { username, password });\n            const receivedToken = res.data.access_token;\n            if (!receivedToken) { throw new Error(\"API'den geÃ§erli token alÄ±namadÄ±.\"); }\n\n            if (isRegistering) {\n                toast.success(`Tebrikler! HesabÄ±nÄ±z oluÅŸturuldu. GiriÅŸ sayfasÄ±na yÃ¶nlendiriliyorsunuz.`, { icon: 'âœ…', duration: 5000 });\n                setIsRegistering(false);\n                setPassword('');\n            } else {\n                // GiriÅŸ baÅŸarÄ±lÄ±:\n                localStorage.setItem('qc_token', receivedToken);\n\n                // KRÄ°TÄ°K: setToken'Ä± Ã§aÄŸÄ±r ve anahtarÄ± deÄŸiÅŸtirerek App.jsx'i zorla.\n                setToken(receivedToken);\n                setAuthKey(prev => prev + 1);\n\n                // Form alanlarÄ±nÄ± temizle\n                setUsername('');\n                setPassword('');\n                setErrors({username: false, password: false});\n\n                toast.success(`GiriÅŸ BaÅŸarÄ±lÄ±! Sisteme hoÅŸ geldiniz, ${username}.`, { icon: 'ðŸ‘‹' });\n            }\n        } catch (err) { /* ... hata yÃ¶netimi aynÄ± kalÄ±r ... */ } finally { setAuthLoading(false); }\n    }, [username, password, isRegistering]);\n\n    // --- Ä°ÅžLEV: Oturumu Kapatma ---\n    const handleLogout = useCallback(() => {\n        localStorage.removeItem('qc_token');\n        setToken(null);\n        setAuthKey(prev => prev + 1); // Logout'ta da yenile\n        setUsername('');\n        setPassword('');\n        setErrors({username:false, password:false});\n        toast('Oturum gÃ¼venli bir ÅŸekilde sonlandÄ±rÄ±ldÄ±.', {icon:'ðŸ”’'});\n    }, []);\n\n    // --- Ä°ÅžLEV: Åžifremi Unuttum ---\n    const handleForgotPassword = useCallback(() => { /* ... aynÄ± kalÄ±r ... */ }, []);\n\n    // --- KAPSÃœLLENMÄ°Åž ARAYÃœZ ---\n    return {\n        // State ve DeÄŸerler\n        token: token, // ArtÄ±k sadece token'Ä± dÃ¶ndÃ¼rÃ¼yoruz.\n        authKey,\n        strengthScore,\n        isRegistering,\n        username,\n        password,\n        showPassword,\n        authLoading,\n        errors,\n\n        // YÃ¼kleniyorsa boÅŸ ekran gÃ¶ster (UX)\n        isInitialized: !isLoadingInitial,\n\n        // State DeÄŸiÅŸtiriciler (Setters)\n        setUsername: (value) => { /* ... */ setUsername(value); if(errors.username) setErrors(e => ({...e, username: false})); },\n        setPassword: (value) => { /* ... */ setPassword(value); if(errors.password) setErrors(e => ({...e, password: false})); },\n        setIsRegistering,\n        setShowPassword,\n\n        // Ä°ÅŸlevler\n        handleAuth,\n        handleLogout,\n        handleForgotPassword,\n    };\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}